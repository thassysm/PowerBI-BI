--CONSULTA EM BANCO RH, BUSCANDO DADOS DOS EMPREGADOS, CARGO E ETC
SELECT
  LPAD(T1.NUMCPF, 11, 0) NUMCPF
  ,T1.NOMFUN NOME_COMPLETO
  ,T0.NUMEMP EMPRESA_ID
  ,T0.NOMEMP EMPRESA_NOME
  ,DECODE(T1.TIPCOL,1,'EMPREGADO',2,'TERCEIROS',3,'PARCEIRO',T1.TIPCOL)TIPO
  ,T3.CODCAR CARGO_ID
  ,T3.TITRED CARGO_DESC
  ,T8.POSTRA AREA_ID
  ,T8.DESRED AREA_CARGO
  ,TO_CHAR(T1.DATNAS,'YYYY-MM-DD') DT_NASCIMENTO
  ,T5.CODEST ESTADO
  ,T6.NOMCID CIDADE
  ,T2.DDDTEL || '-' || T2.NUMTEL TEL_CELULAR
  ,T2.EMACOM EMAIL
  ,TO_CHAR(T1.DATADM,'YYYY-MM-DD') DT_ADMISSAO
  ,TO_CHAR(T1.DATINC,'YYYY-MM-DD') DT_CADASTRO
  ,TO_CHAR(T1.USU_DATALT,'YYYY-MM-DD') DT_ALTERA
  ,DECODE(T1.TIPSEX, 'M', 'MASCULINO', 'F', 'FEMININO') SEXO
  ,CASE
    WHEN SITAFA IN (320, 184, 313, 314, 084, 080, 900, 901, 014, 073, 023, 064, 057, 103, 193, 104, 318, 013, 063, 910, 912, 914, 913, 921,
            911, 922, 089, 189, 085, 185, 321, 324, 086, 186, 915, 317, 319, 180, 190, 095, 916, 183, 018, 017, 097, 297, 107, 108,
            015, 065, 090, 093, 316, 094, 071, 096, 002, 100, 012, 062, 021, 052, 917, 305, 306, 307, 308, 309, 310, 301, 302, 303,
            304, 066, 016, 205, 206, 091, 191, 323, 020, 027, 059, 010, 060, 008, 058, 074, 024, 009, 087, 187, 006, 056, 011, 061,
            081, 181, 311, 026, 076, 999, 088, 188, 025, 075, 092, 918, 101, 192, 102, 105, 106, 201, 202, 099, 312, 005, 055, 098,
            923, 919, 082, 182, 920, 001, 051, 315, 083, 203, 204)
      THEN 'ATIVO'
    WHEN SITAFA IN (004, 054, 032, 072, 322, 003, 053, 019, 069)
      THEN 'AFASTADO'
    WHEN SITAFA IN (022, 007, 011, 006)
      THEN 'INATIVO'
    END AS SITUACAO
  ,T13.NOMLOC LOCAL_ORGANOGRAMA
  ,DECODE(TO_CHAR(T1.DATAFA,'YYYY-MM-DD'),'1900-12-31',NULL,TO_CHAR(T1.DATAFA,'YYYY-MM-DD'))DT_AFASTAMENTO
  --,TO_CHAR(DECODE(T1.DATAFA, '31/12/1900', NULL, T1.DATAFA),'YYYY-MM-DD') DT_AFASTAMENTO
FROM XXXXXXX T1                                   --EMPREGADOS
  LEFT JOIN R030EMP T0 ON T0.NUMEMP = T1.XXXXXXX --EMPRESA
  LEFT JOIN R034CPL T2 ON T1.XXXXXXX = T2.NUMEMP
                      AND T1.TIPCOL = T2.TIPCOL
                      AND T1.NUMCAD = T2.NUMCAD -- FICHA COMPLEMENTAR
  JOIN XXXXXXX T3 ON T1.XXXXXXX = T3.CODCAR
                 AND T1.ESTCAR = T3.ESTCAR -- CARGO
  LEFT JOIN R074EST T5 ON T2.XXXXXXX = T5.CODEST -- ESTADOS
  LEFT JOIN XXXXXXX T6 ON T2.CODCID = T6.CODCID -- CIDADE
  LEFT JOIN R017POS T8 ON T1.ESTPOS = T8.ESTPOS
                      AND T1.XXXXXXX = T8.POSTRA -- POSTO TRABALHO
  JOIN R016ORN T13 ON T1.TABORG = T13.TABORG
                   AND T1.XXXXXXX = T13.NUMLOC -- ORGANOGRAMA
  
WHERE (
    T1.DATAFA = '31/12/1900'
    OR T1.DATAFA >= SYSDATE - 15) --AFASTADOS ATE 15 DIAS ATRAS | ALTERADO OS 90014
ORDER BY T1.XXXXXXX;

----------------------------------------------------------------------------------------------------
--DADOS MEDICO DO BANCO TASY
select 
t1.cd_pessoa_fisica
,(select DS_CATEGORIA from MEDICO_CATEGORIA where NR_SEQUENCIA = t1.NR_SEQ_CATEGORIA and IE_SITUACAO = 'A')Med_categoria
,t1.DT_ATUALIZACAO_NREC dt_inclusao
,t1.dt_admissao dt_admissao
,t1.dt_atualizacao dt_atualizacao
,t1.ie_situacao status
,t2.NR_CPF cpf
,t2.nm_pessoa_fisica
,Obter_Desc_Espec_medica(obter_especialidade_medico(t2.cd_pessoa_fisica,'n'))espec_principal
from medico t1,XXXXXXX t2
where t1.CD_PESSOA_FISICA = t2.CD_PESSOA_FISICA
